<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chore & Pocket Money Tracker</title>
  <style>
    /*
      Friendly, bright colors and large tap targets for a fridge screen.
      Change --accent to quickly retheme the page.
    */
    :root {
      --accent: #ef4444;      /* primary red accent */
      --accent-dark: #b91c1c; /* deeper red for contrast */
      --bg: #f4f7fb;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #6b7280;
      --success: #34d399;
      --danger: #ef4444;
      --shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Trebuchet MS", "Segoe UI", sans-serif;
      background: radial-gradient(circle at 18% 18%, rgba(239, 68, 68, 0.18), transparent 25%),
        radial-gradient(circle at 82% 10%, rgba(52, 211, 153, 0.2), transparent 25%),
        var(--bg);
      color: var(--text);
      padding: 16px;
    }

    header {
      text-align: center;
      margin-bottom: 16px;
    }

    h1 {
      margin: 0;
      font-size: 2.4rem;
      letter-spacing: 0.5px;
      color: var(--accent-dark);
    }

    h2 {
      margin: 0 0 8px;
      font-size: 1.2rem;
      color: var(--text);
    }

    p.subtitle {
      margin: 6px 0 0;
      color: var(--muted);
    }

    .grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      margin-bottom: 16px;
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 16px;
      box-shadow: var(--shadow);
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid #e5e7eb;
      font-size: 1rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255, 166, 43, 0.25);
    }

    button {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      color: #fff;
      background: linear-gradient(135deg, var(--accent), var(--accent-dark));
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
      box-shadow: 0 10px 20px rgba(255, 166, 43, 0.25);
    }

    button:active {
      transform: scale(0.98);
    }

    .inline {
      display: flex;
      gap: 12px;
    }

    .inline input,
    .inline select {
      flex: 1;
    }

    .progress-wrapper {
      margin-top: 10px;
    }

    .progress-track {
      background: #e5e7eb;
      height: 20px;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }

    .progress-fill {
      background: linear-gradient(90deg, var(--success), #10b981);
      height: 100%;
      width: 0%;
      border-radius: inherit;
      transition: width 0.25s ease;
    }

    .progress-text {
      margin-top: 6px;
      font-weight: 600;
      color: var(--text);
    }

    .goal-hint {
      margin-top: 6px;
      color: var(--muted);
      font-size: 0.95rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #f1f5f9;
    }

    th {
      background: #f9fafb;
      font-size: 0.95rem;
    }

    td:first-child {
      text-align: left;
    }

    .chore-name {
      font-weight: 700;
    }

    .description {
      margin-top: 4px;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .day-box {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      margin: 4px 2px;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease;
    }

    .day-box input {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    .day-box:hover {
      border-color: var(--accent);
    }

    .earned {
      font-weight: 700;
      color: var(--success);
      font-size: 1.05rem;
    }

    .delete-btn {
      background: #fee2e2;
      color: var(--danger);
      border: 2px solid #fecaca;
      box-shadow: none;
      padding: 8px 12px;
      width: auto;
    }

    .delete-btn:hover {
      background: #fecdd3;
    }

    .summary {
      margin-top: 14px;
      padding: 14px 16px;
      background: #1f2937;
      color: #fff;
      border-radius: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
    }

    .summary .reset-btn {
      width: auto;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      box-shadow: 0 10px 20px rgba(37, 99, 235, 0.25);
    }

    .badge {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: #fef3c7;
      color: #92400e;
      font-weight: 700;
      font-size: 0.9rem;
    }

    .stats-list {
      margin: 0;
      padding: 0;
      list-style: none;
      display: grid;
      gap: 6px;
    }

    .stats-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f9fafb;
      padding: 10px 12px;
      border-radius: 10px;
      font-weight: 600;
    }

    .error {
      color: var(--danger);
      font-weight: 600;
      margin-top: 6px;
    }

    .celebrate {
      margin-top: 8px;
      color: var(--success);
      font-weight: 700;
    }

    /* Simple celebration layer for confetti + emoji without external libs */
    .celebration-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 999;
    }

    /* Fireworks particles */
    .firework-particle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      opacity: 0.9;
      animation: explode 1s ease-out forwards;
      will-change: transform, opacity;
    }

    .firework-emoji {
      position: absolute;
      font-size: 24px;
      animation: explode 1s ease-out forwards;
      will-change: transform, opacity;
    }

    .sparkle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #fff, rgba(255, 255, 255, 0));
      border-radius: 50%;
      animation: sparklePop 1s ease-out forwards;
      box-shadow: 0 0 12px rgba(255, 255, 255, 0.8);
      will-change: transform, opacity;
    }

    @keyframes explode {
      0% { transform: translate(0, 0) scale(0.6); opacity: 1; }
      100% { transform: translate(var(--dx), var(--dy)) scale(1.1); opacity: 0; }
    }

    @keyframes sparklePop {
      0% { transform: scale(0.4); opacity: 1; }
      80% { transform: scale(1.4); opacity: 1; }
      100% { transform: scale(1.6); opacity: 0; }
    }

    .week-note {
      color: var(--muted);
      font-size: 0.95rem;
    }

    @media (max-width: 900px) {
      th, td {
        padding: 10px 8px;
      }

      .day-box {
        margin: 2px 1px;
      }
    }
  </style>
</head>
<body>
  <header>
    <!-- Change the name here to personalize the chart title -->
    <h1>Angus' Chore Chart</h1>
    <p class="subtitle">Tick off chores, watch pocket money grow, track streaks, and hit goals!</p>
  </header>

  <div class="grid">
    <div class="card">
      <h2>Weekly Goal</h2>
      <p class="goal-hint">Set a weekly pocket money goal to see progress.</p>
      <div class="inline" style="margin-bottom: 8px;">
        <input type="number" id="goalInput" min="0" step="0.01" inputmode="decimal" placeholder="Enter goal in dollars" />
        <button id="setGoalBtn" style="max-width: 180px;">Set Goal</button>
      </div>
      <div class="progress-wrapper">
        <div class="progress-track">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Set a weekly goal to track progress</div>
      </div>
    </div>

    <div class="card">
      <h2>Stats & Wins</h2>
      <ul class="stats-list">
        <li><span>Total This Week (Chores)</span><span id="statTotalWeek">$0.00</span></li>
        <li><span>Top Chore This Week</span><span id="statTopWeek">â€”</span></li>
        <li><span>All-time Top Chore</span><span id="statTopAllTime">â€”</span></li>
        <li><span>Big Goals Rewards</span><span id="statBigGoals">$0.00</span></li>
        <li><span>Lifetime Pocket Money</span><span id="statLifetime">$0.00</span></li>
      </ul>
      <div class="week-note" id="weekNote"></div>
    </div>

    <div class="card">
      <h2>Add a Chore</h2>
      <label for="choreName">Chore Name *</label>
      <input type="text" id="choreName" placeholder="e.g. Feed the dog" required />

      <label for="choreDescription">Description (optional)</label>
      <input type="text" id="choreDescription" placeholder="e.g. Morning and evening" />

      <div class="inline">
        <div style="flex: 1;">
          <label for="choreValue">Value ($) *</label>
          <input type="number" id="choreValue" placeholder="e.g. 2.50" min="0" step="0.01" inputmode="decimal" required />
        </div>
        <div style="flex: 1;">
          <label for="choreFrequency">Frequency</label>
          <select id="choreFrequency">
            <option value="per-day">Per Day</option>
            <option value="per-week">Per Week</option>
          </select>
        </div>
      </div>

      <button id="addChoreBtn" style="margin-top: 12px;">Add Chore</button>
      <div class="error" id="formError" style="display:none;"></div>
    </div>

    <div class="card">
      <h2>Big Goals & Rewards</h2>
      <label for="goalName">Goal Name *</label>
      <input type="text" id="goalName" placeholder="e.g. Finish Suzuki Book 1" />

      <label for="goalDesc">Description (optional)</label>
      <input type="text" id="goalDesc" placeholder="e.g. 20 songs mastered" />

      <div class="inline">
        <div style="flex: 1;">
          <label for="goalReward">Reward Amount ($) *</label>
          <input type="number" id="goalReward" placeholder="e.g. 100" min="0" step="0.01" inputmode="decimal" />
        </div>
        <div style="flex: 1; display:flex; align-items:flex-end;">
          <button id="addBigGoalBtn">Add Goal</button>
        </div>
      </div>
      <div class="error" id="bigGoalError" style="display:none;"></div>
      <div class="celebrate" id="bigGoalCelebrate" style="display:none;">Woohoo! Big goal completed!</div>
    </div>
  </div>

  <div class="card" style="padding: 0;">
    <table>
      <thead>
        <tr>
          <th>Chore</th>
          <th>Value</th>
          <th>Mon</th>
          <th>Tue</th>
          <th>Wed</th>
          <th>Thu</th>
          <th>Fri</th>
          <th>Sat</th>
          <th>Sun</th>
          <th>Weekly Earned</th>
          <th>Week Streak</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody id="choreTableBody">
        <!-- Rows are injected here by JavaScript -->
      </tbody>
    </table>
  </div>

  <div class="card" style="padding: 0; margin-top: 16px;">
    <table>
      <thead>
        <tr>
          <th>Goal</th>
          <th>Reward</th>
          <th>Completed?</th>
        </tr>
      </thead>
      <tbody id="bigGoalsBody">
        <!-- Big goals rendered here -->
      </tbody>
    </table>
  </div>

  <div class="summary">
    <div>
      <strong>Total Pocket Money This Week (Chores):</strong>
      <span id="totalEarned">$0.00</span>
    </div>
    <div>
      <span class="badge">Lifetime Pocket Money: <span id="lifetimeBadge">$0.00</span></span>
    </div>
    <div class="week-note" id="weekLabel"></div>
    <button class="reset-btn" id="resetWeekBtn">Reset Week</button>
  </div>

  <!-- Layer used for lightweight confetti/emoji celebration -->
  <div class="celebration-layer" id="celebrationLayer"></div>

  <script>
    // ====== Data storage keys (namespaced for clarity) ======
    const STORAGE_KEY = "choresData"; // Chores array key
    const GOAL_KEY = "choresWeeklyGoal"; // Weekly goal number
    const BIG_GOALS_KEY = "choresBigGoals"; // Big goals array
    const WEEK_START_KEY = "choresWeekStart"; // Simple date label for the week
    const CELEBRATION_EMOJIS = ["ðŸŽ‡", "ðŸŽ†", "ðŸŒŸ", "âœ¨", "ðŸ’¥", "ðŸŽ‰"]; // Swap or add emoji if you want

    /*
      Chore object shape saved in localStorage:
      {
        id: "unique-id-string",
        name: "Feed the dog",
        description: "Morning and evening",
        value: 2.0, // dollars
        frequency: "per-day" | "per-week",
        daysDone: [false, true, false, true, false, false, false], // Mon-Sun
        totalEarnedLifetime: 0, // total $$$ from this chore across all weeks
        weeksInARow: 0,          // current streak of weeks with > $0 earned
        bestWeekStreak: 0        // longest streak ever
      }
    */

    /*
      Big goal object shape saved in localStorage:
      {
        id: "unique-id-string",
        name: "Finish Suzuki Book 1",
        description: "20 songs mastered",
        reward: 100, // dollars
        completed: false
      }
    */

    let chores = [];
    let weeklyGoal = 0;
    let bigGoals = [];
    let weekStart = "";

    // Helper: format numbers as $X.XX
    function formatMoney(amount) {
      return `$${amount.toFixed(2)}`;
    }

    // Helper: create a unique id for each chore/goal (good enough for this page)
    function createId(prefix = "item") {
      return `${prefix}-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
    }

    // Load stored data when the page starts
    function loadData() {
      const savedChores = localStorage.getItem(STORAGE_KEY);
      const savedGoal = localStorage.getItem(GOAL_KEY);
      const savedBigGoals = localStorage.getItem(BIG_GOALS_KEY);
      const savedWeekStart = localStorage.getItem(WEEK_START_KEY);

      if (savedChores) {
        try {
          chores = JSON.parse(savedChores);
        } catch (e) {
          chores = [];
        }
      }

      if (savedGoal) {
        weeklyGoal = parseFloat(savedGoal) || 0;
        document.getElementById("goalInput").value = weeklyGoal || "";
      }

      if (savedBigGoals) {
        try {
          bigGoals = JSON.parse(savedBigGoals);
        } catch (e) {
          bigGoals = [];
        }
      }

      weekStart = savedWeekStart || new Date().toLocaleDateString();
      document.getElementById("weekLabel").textContent = `Week starting: ${weekStart}`;
      document.getElementById("weekNote").textContent = `Tracking streaks from ${weekStart}`;
    }

    // Save chores to localStorage so they persist
    function saveChores() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(chores));
    }

    // Save goal to localStorage
    function saveGoal() {
      localStorage.setItem(GOAL_KEY, weeklyGoal);
    }

    // Save big goals to localStorage
    function saveBigGoals() {
      localStorage.setItem(BIG_GOALS_KEY, JSON.stringify(bigGoals));
    }

    // Calculate how much a single chore earned this week based on its type and checkboxes
    function calculateChoreEarned(chore) {
      const daysCompleted = chore.daysDone.filter(Boolean).length;
      if (chore.frequency === "per-day") {
        return chore.value * daysCompleted;
      }
      // For "per-week" chores we only pay if ALL 7 days are ticked; otherwise $0.
      // This rewards consistent completion across the full week.
      return daysCompleted === 7 ? chore.value : 0;
    }

    // Update totals, progress bar, and stats
    function updateTotals() {
      let total = 0;
      chores.forEach((chore) => {
        const earned = calculateChoreEarned(chore);
        const earnedCell = document.querySelector(`[data-earned-id="${chore.id}"]`);
        if (earnedCell) earnedCell.textContent = formatMoney(earned);
        total += earned;
      });
      document.getElementById("totalEarned").textContent = formatMoney(total);
      updateProgress(total);
      updateStats(total);
    }

    // Progress bar logic, capped at 100%
    function updateProgress(total) {
      const fill = document.getElementById("progressFill");
      const text = document.getElementById("progressText");

      if (!weeklyGoal || weeklyGoal <= 0) {
        fill.style.width = "0%";
        text.textContent = "Set a weekly goal to track progress";
        return;
      }

      const percent = Math.min(100, (total / weeklyGoal) * 100);
      fill.style.width = `${percent}%`;
      const percentLabel = percent.toFixed(0);
      text.textContent = `Progress: ${formatMoney(total)} of ${formatMoney(weeklyGoal)} (${percentLabel}%)`;
    }

    // Fireworks + cheer each time a task is ticked on
    function celebrateCheckbox() {
      const layer = document.getElementById("celebrationLayer");
      if (!layer) return;

      const bursts = 3; // number of simultaneous fireworks
      for (let b = 0; b < bursts; b++) {
        const originX = 20 + Math.random() * 60; // percent across screen
        const originY = 20 + Math.random() * 40; // percent down
        launchFirework(layer, originX, originY);
      }

      playCheer();
    }

    // Build a single firework burst with colored particles + emoji + sparkles
    function launchFirework(layer, originXPercent, originYPercent) {
      const particles = 22;
      for (let i = 0; i < particles; i++) {
        const angle = (Math.PI * 2 * i) / particles + Math.random() * 0.3;
        const distance = 100 + Math.random() * 80;
        const dx = Math.cos(angle) * distance;
        const dy = Math.sin(angle) * distance;

        const p = document.createElement("span");
        p.className = "firework-particle";
        p.style.left = `${originXPercent}%`;
        p.style.top = `${originYPercent}%`;
        p.style.setProperty("--dx", `${dx}px`);
        p.style.setProperty("--dy", `${dy}px`);
        p.style.background = `radial-gradient(circle, #fff, ${randomColor()})`;
        p.style.animationDuration = `${0.7 + Math.random() * 0.6}s`;
        layer.appendChild(p);
        setTimeout(() => p.remove(), 1200);
      }

      // Emoji pop
      for (let i = 0; i < 6; i++) {
        const emoji = document.createElement("span");
        emoji.className = "firework-emoji";
        emoji.textContent = CELEBRATION_EMOJIS[Math.floor(Math.random() * CELEBRATION_EMOJIS.length)];
        const angle = Math.random() * Math.PI * 2;
        const distance = 60 + Math.random() * 60;
        emoji.style.left = `${originXPercent}%`;
        emoji.style.top = `${originYPercent}%`;
        emoji.style.setProperty("--dx", `${Math.cos(angle) * distance}px`);
        emoji.style.setProperty("--dy", `${Math.sin(angle) * distance}px`);
        emoji.style.animationDuration = `${0.8 + Math.random() * 0.6}s`;
        layer.appendChild(emoji);
        setTimeout(() => emoji.remove(), 1200);
      }

      // Sparkles in the center
      for (let i = 0; i < 10; i++) {
        const spark = document.createElement("span");
        spark.className = "sparkle";
        spark.style.left = `${originXPercent + (Math.random() * 8 - 4)}%`;
        spark.style.top = `${originYPercent + (Math.random() * 8 - 4)}%`;
        spark.style.animationDuration = `${0.5 + Math.random() * 0.4}s`;
        layer.appendChild(spark);
        setTimeout(() => spark.remove(), 900);
      }
    }

    // Simple cheering sound using Web Audio (runs locally, no external audio file)
    function playCheer() {
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      if (!AudioCtx) return;
      const ctx = playCheer.ctx || new AudioCtx();
      playCheer.ctx = ctx;

      const now = ctx.currentTime + 0.05;

      // Crowd-like noise
      const duration = 0.5;
      const buffer = ctx.createBuffer(1, ctx.sampleRate * duration, ctx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < data.length; i++) {
        data[i] = (Math.random() * 2 - 1) * 0.35; // gentle noise
      }
      const noise = ctx.createBufferSource();
      noise.buffer = buffer;
      const noiseGain = ctx.createGain();
      noiseGain.gain.setValueAtTime(0.001, now);
      noiseGain.gain.exponentialRampToValueAtTime(0.12, now + 0.1);
      noiseGain.gain.exponentialRampToValueAtTime(0.001, now + duration);
      noise.connect(noiseGain).connect(ctx.destination);
      noise.start(now);
      noise.stop(now + duration);

      // Two whoop tones for excitement
      [0, 0.1].forEach((offset, idx) => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(idx === 0 ? 520 : 660, now + offset);
        osc.frequency.exponentialRampToValueAtTime(idx === 0 ? 740 : 980, now + offset + 0.3);
        gain.gain.setValueAtTime(0.0001, now + offset);
        gain.gain.exponentialRampToValueAtTime(0.18, now + offset + 0.05);
        gain.gain.exponentialRampToValueAtTime(0.0001, now + offset + 0.45);
        osc.connect(gain).connect(ctx.destination);
        osc.start(now + offset);
        osc.stop(now + offset + 0.5);
      });
    }

    // Helper color generator for fireworks
    function randomColor() {
      return `hsl(${Math.random() * 360}, 90%, 60%)`;
    }

    // Stats panel updater
    function updateStats(totalThisWeek) {
      const weeklyTotal = totalThisWeek;
      const bigGoalRewards = bigGoals.filter((g) => g.completed).reduce((sum, g) => sum + (g.reward || 0), 0);
      const lifetimeChoreEarnings = chores.reduce((sum, c) => sum + (c.totalEarnedLifetime || 0), 0);
      const lifetimePocket = lifetimeChoreEarnings + bigGoalRewards;

      // Top chore this week
      let topWeekName = "â€”";
      let topWeekAmt = 0;
      chores.forEach((ch) => {
        const earned = calculateChoreEarned(ch);
        if (earned > topWeekAmt) {
          topWeekAmt = earned;
          topWeekName = `${ch.name} â€“ ${formatMoney(earned)}`;
        }
      });

      // All-time top chore based on lifetime earnings
      let topAllName = "â€”";
      let topAllAmt = 0;
      chores.forEach((ch) => {
        const life = ch.totalEarnedLifetime || 0;
        if (life > topAllAmt) {
          topAllAmt = life;
          topAllName = `${ch.name} â€“ ${formatMoney(life)}`;
        }
      });

      document.getElementById("statTotalWeek").textContent = formatMoney(weeklyTotal);
      document.getElementById("statTopWeek").textContent = topWeekName;
      document.getElementById("statTopAllTime").textContent = topAllName;
      document.getElementById("statBigGoals").textContent = formatMoney(bigGoalRewards);
      document.getElementById("statLifetime").textContent = formatMoney(lifetimePocket);
      document.getElementById("lifetimeBadge").textContent = formatMoney(lifetimePocket);
    }

    // Render the chore table rows
    function renderChores() {
      const tbody = document.getElementById("choreTableBody");
      tbody.innerHTML = "";

      chores.forEach((chore) => {
        const tr = document.createElement("tr");

        // Chore name + description
        const nameTd = document.createElement("td");
        const nameDiv = document.createElement("div");
        nameDiv.className = "chore-name";
        nameDiv.textContent = chore.name;
        nameTd.appendChild(nameDiv);
        if (chore.description) {
          const desc = document.createElement("div");
          desc.className = "description";
          desc.textContent = chore.description;
          nameTd.appendChild(desc);
        }
        tr.appendChild(nameTd);

        // Value and frequency label
        const valueTd = document.createElement("td");
        const freqLabel = chore.frequency === "per-day" ? "/ day" : "/ week";
        valueTd.textContent = `${formatMoney(chore.value)} ${freqLabel}`;
        tr.appendChild(valueTd);

        // Day checkboxes (Mon-Sun)
        chore.daysDone.forEach((done, index) => {
          const dayTd = document.createElement("td");
          const wrapper = document.createElement("label");
          wrapper.className = "day-box";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = done;
          checkbox.addEventListener("change", () => {
            chore.daysDone[index] = checkbox.checked;
            if (checkbox.checked) {
              celebrateCheckbox();
            }
            saveChores();
            updateTotals();
          });

          wrapper.appendChild(checkbox);
          dayTd.appendChild(wrapper);
          tr.appendChild(dayTd);
        });

        // Earned cell
        const earnedTd = document.createElement("td");
        earnedTd.className = "earned";
        earnedTd.dataset.earnedId = chore.id;
        earnedTd.textContent = formatMoney(calculateChoreEarned(chore));
        tr.appendChild(earnedTd);

        // Streak cell (current / best)
        const streakTd = document.createElement("td");
        streakTd.textContent = `${chore.weeksInARow || 0} wk (best ${chore.bestWeekStreak || 0})`;
        streakTd.dataset.streakId = chore.id;
        tr.appendChild(streakTd);

        // Delete button with confirmation
        const deleteTd = document.createElement("td");
        const delBtn = document.createElement("button");
        delBtn.textContent = "Delete";
        delBtn.className = "delete-btn";
        delBtn.addEventListener("click", () => {
          if (confirm("Are you sure you want to delete this chore?")) {
            chores = chores.filter((c) => c.id !== chore.id);
            saveChores();
            renderChores();
            updateTotals();
          }
        });
        deleteTd.appendChild(delBtn);
        tr.appendChild(deleteTd);

        tbody.appendChild(tr);
      });

      updateTotals();
    }

    // Render big goals table
    function renderBigGoals() {
      const tbody = document.getElementById("bigGoalsBody");
      tbody.innerHTML = "";
      const celebrate = document.getElementById("bigGoalCelebrate");
      celebrate.style.display = "none";

      bigGoals.forEach((goal) => {
        const tr = document.createElement("tr");

        const nameTd = document.createElement("td");
        const nameDiv = document.createElement("div");
        nameDiv.className = "chore-name";
        nameDiv.textContent = goal.name;
        nameTd.appendChild(nameDiv);
        if (goal.description) {
          const desc = document.createElement("div");
          desc.className = "description";
          desc.textContent = goal.description;
          nameTd.appendChild(desc);
        }
        tr.appendChild(nameTd);

        const rewardTd = document.createElement("td");
        rewardTd.textContent = formatMoney(goal.reward);
        tr.appendChild(rewardTd);

        const completeTd = document.createElement("td");
        const wrapper = document.createElement("label");
        wrapper.className = "day-box";
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = goal.completed;
        checkbox.disabled = goal.completed; // prevent unchecking once done
        checkbox.addEventListener("change", () => {
          if (!goal.completed && confirm("Mark this big goal as completed?")) {
            goal.completed = true;
            checkbox.disabled = true;
            celebrate.style.display = "block";
            saveBigGoals();
            updateTotals();
            renderBigGoals();
          } else {
            checkbox.checked = goal.completed;
          }
        });
        wrapper.appendChild(checkbox);
        completeTd.appendChild(wrapper);
        tr.appendChild(completeTd);

        tbody.appendChild(tr);
      });
    }

    // Add chore handler with simple validation
    function addChore() {
      const nameInput = document.getElementById("choreName");
      const descInput = document.getElementById("choreDescription");
      const valueInput = document.getElementById("choreValue");
      const freqSelect = document.getElementById("choreFrequency");
      const errorBox = document.getElementById("formError");

      const name = nameInput.value.trim();
      const description = descInput.value.trim();
      const value = parseFloat(valueInput.value);
      const frequency = freqSelect.value;

      // Basic inline validation for parent convenience
      if (!name) {
        errorBox.textContent = "Please enter a chore name.";
        errorBox.style.display = "block";
        return;
      }
      if (isNaN(value) || value <= 0) {
        errorBox.textContent = "Please add a value greater than $0.";
        errorBox.style.display = "block";
        return;
      }
      errorBox.style.display = "none";

      const newChore = {
        id: createId("chore"),
        name,
        description,
        value,
        frequency,
        daysDone: [false, false, false, false, false, false, false],
        totalEarnedLifetime: 0,
        weeksInARow: 0,
        bestWeekStreak: 0,
      };

      chores.push(newChore);
      saveChores();
      renderChores();

      // Clear form for the next entry
      nameInput.value = "";
      descInput.value = "";
      valueInput.value = "";
      freqSelect.value = "per-day";
    }

    // Add big goal handler
    function addBigGoal() {
      const nameInput = document.getElementById("goalName");
      const descInput = document.getElementById("goalDesc");
      const rewardInput = document.getElementById("goalReward");
      const errorBox = document.getElementById("bigGoalError");

      const name = nameInput.value.trim();
      const description = descInput.value.trim();
      const reward = parseFloat(rewardInput.value);

      if (!name) {
        errorBox.textContent = "Please enter a goal name.";
        errorBox.style.display = "block";
        return;
      }
      if (isNaN(reward) || reward <= 0) {
        errorBox.textContent = "Please enter a reward greater than $0.";
        errorBox.style.display = "block";
        return;
      }
      errorBox.style.display = "none";

      const newGoal = {
        id: createId("goal"),
        name,
        description,
        reward,
        completed: false,
      };

      bigGoals.push(newGoal);
      saveBigGoals();
      renderBigGoals();
      updateTotals();

      nameInput.value = "";
      descInput.value = "";
      rewardInput.value = "";
    }

    function setGoal() {
      const input = document.getElementById("goalInput");
      const raw = parseFloat(input.value);
      if (isNaN(raw) || raw <= 0) {
        alert("Please enter a goal greater than $0.");
        return;
      }
      weeklyGoal = raw;
      saveGoal();
      updateTotals();
    }

    // Reset week logic: adds this week's earnings to lifetime and updates streaks
    function resetWeek() {
      if (!confirm("Reset the week? This moves earned amounts into lifetime totals and clears the checkboxes.")) {
        return;
      }

      chores.forEach((chore) => {
        const earned = calculateChoreEarned(chore);
        chore.totalEarnedLifetime = (chore.totalEarnedLifetime || 0) + earned;
        if (earned > 0) {
          chore.weeksInARow = (chore.weeksInARow || 0) + 1;
        } else {
          chore.weeksInARow = 0;
        }
        chore.bestWeekStreak = Math.max(chore.bestWeekStreak || 0, chore.weeksInARow);
        chore.daysDone = [false, false, false, false, false, false, false];
      });

      weekStart = new Date().toLocaleDateString();
      localStorage.setItem(WEEK_START_KEY, weekStart);
      document.getElementById("weekLabel").textContent = `Week starting: ${weekStart}`;
      document.getElementById("weekNote").textContent = `Tracking streaks from ${weekStart}`;

      saveChores();
      renderChores();
      updateTotals();
    }

    // Hook up event listeners
    document.getElementById("addChoreBtn").addEventListener("click", addChore);
    document.getElementById("addBigGoalBtn").addEventListener("click", addBigGoal);
    document.getElementById("setGoalBtn").addEventListener("click", setGoal);
    document.getElementById("resetWeekBtn").addEventListener("click", resetWeek);

    // Initialize the page
    loadData();
    renderChores();
    renderBigGoals();
    updateTotals();
  </script>
</body>
</html>
